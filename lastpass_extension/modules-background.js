(function(){"use strict";var e,t,r;!function(o){var i,n,s,a,u={},c={},l={},d={},p=Object.prototype.hasOwnProperty,f=[].slice,m=/\.js$/;function y(e,t){return p.call(e,t)}function v(e,t){var r,o,i,n,s,a,u,c,d,p,f,y=t&&t.split("/"),v=l.map,g=v&&v["*"]||{};if(e){for(s=(e=e.split("/")).length-1,l.nodeIdCompat&&m.test(e[s])&&(e[s]=e[s].replace(m,"")),"."===e[0].charAt(0)&&y&&(e=y.slice(0,y.length-1).concat(e)),d=0;d<e.length;d++)if("."===(f=e[d]))e.splice(d,1),d-=1;else if(".."===f){if(0===d||1===d&&".."===e[2]||".."===e[d-1])continue;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}if((y||g)&&v){for(d=(r=e.split("/")).length;d>0;d-=1){if(o=r.slice(0,d).join("/"),y)for(p=y.length;p>0;p-=1)if((i=v[y.slice(0,p).join("/")])&&(i=i[o])){n=i,a=d;break}if(n)break;!u&&g&&g[o]&&(u=g[o],c=d)}!n&&u&&(n=u,a=c),n&&(r.splice(0,a,n),e=r.join("/"))}return e}function g(e,t){return function(){var r=f.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),n.apply(o,r.concat([e,t]))}}function h(e){return function(t){u[e]=t}}function b(e){if(y(c,e)){var t=c[e];delete c[e],d[e]=!0,i.apply(o,t)}if(!y(u,e)&&!y(d,e))throw new Error("No "+e);return u[e]}function w(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function _(e){return e?w(e):[]}s=function(e,t){var r,o,i=w(e),n=i[0],s=t[1];return e=i[1],n&&(r=b(n=v(n,s))),n?e=r&&r.normalize?r.normalize(e,(o=s,function(e){return v(e,o)})):v(e,s):(n=(i=w(e=v(e,s)))[0],e=i[1],n&&(r=b(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:r}},a={require:function(e){return g(e)},exports:function(e){var t=u[e];return void 0!==t?t:u[e]={}},module:function(e){return{id:e,uri:"",exports:u[e],config:(t=e,function(){return l&&l.config&&l.config[t]||{}})};var t}},i=function(e,t,r,i){var n,l,p,f,m,v,w,q=[],P=typeof r;if(v=_(i=i||e),"undefined"===P||"function"===P){for(t=!t.length&&r.length?["require","exports","module"]:t,m=0;m<t.length;m+=1)if("require"===(l=(f=s(t[m],v)).f))q[m]=a.require(e);else if("exports"===l)q[m]=a.exports(e),w=!0;else if("module"===l)n=q[m]=a.module(e);else if(y(u,l)||y(c,l)||y(d,l))q[m]=b(l);else{if(!f.p)throw new Error(e+" missing "+l);f.p.load(f.n,g(i,!0),h(l),{}),q[m]=u[l]}p=r?r.apply(u[e],q):void 0,e&&(n&&n.exports!==o&&n.exports!==u[e]?u[e]=n.exports:p===o&&w||(u[e]=p))}else e&&(u[e]=r)},e=t=n=function(e,t,r,u,c){if("string"==typeof e)return a[e]?a[e](t):b(s(e,_(t)).f);if(!e.splice){if((l=e).deps&&n(l.deps,l.callback),!t)return;t.splice?(e=t,t=r,r=null):e=o}return t=t||function(){},"function"==typeof r&&(r=u,u=c),u?i(o,e,t,r):setTimeout(function(){i(o,e,t,r)},4),n},n.config=function(e){return n(e)},e._defined=u,(r=function(e,t,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(r=t,t=[]),y(u,e)||y(c,e)||(c[e]=[e,t,r])}).amd={jQuery:!0}}();var o,i=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(i,n){function s(e){try{u(o.next(e))}catch(e){n(e)}}function a(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(s,a)}u((o=o.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,o,i,n,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},s=this&&this.__assign||Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},a=this&&this.__decorate||function(e,t,r,o){var i,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n<3?i(s):n>3?i(t,r,s):i(t,r))||s);return n>3&&s&&Object.defineProperty(t,r,s),s},u=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});r("common/module.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this._isInitialized=!1,this.initializedQueue=[],setTimeout(function(){return i(e,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,this.initialize()];case 1:return e.sent(),[4,this.postInitialize()];case 2:for(e.sent(),this._isInitialized=!0;this.initializedQueue.length;)try{this.initializedQueue.pop()()}catch(e){console.error(e)}return[2]}})})})}return e.prototype.isInitialized=function(e){this._isInitialized?e():this.initializedQueue.push(e)},e}();t.ModuleAbstract=r}),r("common/enums/auto-fill-action",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AutoFillAction||(t.AutoFillAction={})).Login="Login",r.Email="Email",r.Address="Address",r.PersonalName="PersonalName"}),r("common/enums/auto-fill-input-category",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AutoFillInputCategory||(t.AutoFillInputCategory={})).Name="name",r.FullName="fullName",r.FirstName="firstName",r.LastName="lastName",r.Address="address",r.Email="email",r.Password="password",r.UserName="userName"}),r("common/enums/auto-fill-method",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.AutoFillAlgorithm||(t.AutoFillAlgorithm={})).Legacy="Legacy",r.Euclidean="Euclidean"}),r("common/enums/feature-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.FeatureType||(t.FeatureType={})).AngularFrontendEnabled="angularFrontendEnabled",r.AutoFillControl="autofill_control",r.AutoFillTest="autofill_test",r.BetterGeneratePasswordEnabled="better_generate_password_enabled",r.Block30="block_3_0",r.EmergencyAccessRestricted="emergency_access_restricted",r.EzpassControl="ezpass_control",r.EzpassTest="ezpass_test",r.FamiliesEnabled="families_enabled",r.FamilyLegacySharedFoldersEnabled="family_legacy_shared_folders_enabled",r.FamilySharedFoldersEnabled="family_shared_folders_enabled",r.FormfillMigration="formfill_migration",r.Freamon="freamon",r.HealthMonitoring="health_monitoring",r.ICOB="icob",r.IntroTutorialVersion="intro_tutorial_version",r.IsDogfood="isDogfood",r.IsInfieldEnabled="is_infield_enabled",r.IsMobileActive="is_mobile_active",r.NewSaveSite="new_save_site",r.OmarDrawer="omardrawer",r.OmarIa="omaria",r.OmarInfieldB="omar_infield_b",r.OmarInfieldC="omar_infield_c",r.OneToOneSharingRestricted="one_to_one_sharing_restricted",r.PasswordSubmittedEvent="password_submitted_event",r.Pdkdf2IterationsMigration="pbkdf2_iterations_migration",r.Retire30="retire_3_0",r.TryFamiliesEnabled="try_families_enabled",r.TutorialEnabled="tutorial_enabled",r.Ziggy="ziggy"}),r("common/enums/repository-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.RepositoryType||(t.RepositoryType={})).Feature="Feature",r.AutoFillState="AutoFillState"}),r("common/enums/resolver-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ResolverType||(t.ResolverType={})).PasswordSubmitted="Password Submitted",r.InjectedPasswordSubmitted="Injected Password Submitted"}),r("common/enums/service-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.ServiceType||(t.ServiceType={})).BasicAuth="BasicAuth",r.ContentScriptTools="ContentScriptTools",r.DomUtils="DomUtils",r.FormDetection="FormDetection",r.AutoFill="AutoFill",r.FormParser="FormParser",r.Segment="Segment",r.SiteParser="SiteParser",r.StringUtils="StringUtils",r.Topic="Topic",r.WebRequest="WebRequest",r.WebRequestShim="WebRequestShim"}),r("common/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/enums/topic-type",["require","exports"],function(e,t){var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.TopicType||(t.TopicType={}))[r.LoginFinished=self.Topics.LOGIN_FINISHED]="LoginFinished",r[r.ClearData=self.Topics.CLEAR_DATA]="ClearData",r[r.RequestFrameworkInitialized=self.Topics.REQUEST_FRAMEWORK_INITIALIZED]="RequestFrameworkInitialized",r[r.ProcessedFormSubmit=self.Topics.PROCESSED_FORM_SUBMIT]="ProcessedFormSubmit"}),r("common/enums/index",["require","exports","common/enums/auto-fill-action","common/enums/auto-fill-input-category","common/enums/auto-fill-method","common/enums/feature-type","common/enums/repository-type","common/enums/resolver-type","common/enums/service-type","common/enums/topic-type"],function(e,t,r,o,i,n,s,a,u,c){function l(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),l(r),l(o),l(i),l(n),l(s),l(a),l(u),l(c)}),r("common/repositories/auto-fill-state/auto-fill-algorithm-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/repositories/auto-fill-state/auto-fill-frame-state",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/repositories/auto-fill-state/auto-fill-state",["require","exports","common/enums/index"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.tabId=e,this.url=t,this.frames={}}return Object.defineProperty(e.prototype,"isReady",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){var r=e.frames[t];return r.isReady||!r.isAllowed})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAllowed",{get:function(){var e=this;return Object.keys(this.frames).every(function(t){return e.frames[t].isAllowed})},enumerable:!0,configurable:!0}),e.prototype.tryGetFrame=function(e){return this.frames[e]||(this.frames[e]=this.getEmptyFrame()),this.frames[e]},e.prototype.getEmptyFrame=function(){return{elements:{},isAllowed:!0,isReady:!1}},e.prototype.setFrameAllowed=function(e,t){this.tryGetFrame(e).isAllowed=t},e.prototype.setFrameReady=function(e,t){this.tryGetFrame(e).isReady=t},e.prototype.getFrameAlgorithmState=function(e,t,r){var o=this.tryGetFrame(e);if(o.elements[t])return o.elements[t][r]},e.prototype.setFrameAlgorithmState=function(e,t,r,o){var i=this.tryGetFrame(e),n=i.elements[t];n||(n={},i.elements[t]=n),i.elements[t][r]=s({},n[r],o)},e.prototype.resetFrameState=function(e){this.frames[e]&&(this.frames[e]=this.getEmptyFrame())},e.prototype.deleteFrameState=function(e){this.frames[e]&&delete this.frames[e]},e.prototype.getResults=function(){var e=this,t={count:0};Object.keys(r.AutoFillAlgorithm).forEach(function(e){t[e]=0});var o={allowed:this.isAllowed,userName:s({},t),password:s({},t)};return Object.keys(this.frames).forEach(function(i){var n=e.frames[i];n.isAllowed&&n.isReady&&Object.keys(n.elements).forEach(function(e){return Object.keys(n.elements[e]).forEach(function(i){var a=n.elements[e][i].filledWith;if(a&&"none"!==a){o[a]||(o[a]=s({},t));var u=o[a][i]+1;i===r.AutoFillAlgorithm.Legacy&&(o[a].count=u),o[a][i]=u}})})}),o},e}();t.AutoFillState=o}),r("common/repositories/auto-fill-state/index",["require","exports","common/repositories/auto-fill-state/auto-fill-state"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r)}),r("common/interfaces/auto-fill-state.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/auto-fill.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/feature.repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/repository",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/segment.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/serializable-callback",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/serializable-value",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/web-request-shim.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/web-request.service",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("common/provider.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){void 0===t&&(t=!0);var r=this;this.instances={},this.initialized=!1,e&&e.size&&(this.map=e,this.map.forEach(function(e,o){e.delegated&&!t||(r.instances[o]=new e.ctor)}))}return e.prototype.initialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){return e.instances[t].initialize()}),this.initialized=!0},e.prototype.postInitialize=function(){var e=this;Object.keys(this.instances).forEach(function(t){"function"==typeof e.instances[t].postInitialize&&e.instances[t].postInitialize()})},e.prototype.teardown=function(){var e=this;Object.keys(this.instances).forEach(function(t){e.instances[t]&&"function"==typeof e.instances[t].destroy&&e.instances[t].destroy()})},e}();t.ProviderAbstract=r}),r("common/decorators/register-repository.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;t.RegisterRepository=function(e,t){return void 0===t&&(t=!1),function(o){r.set(e,{ctor:o,delegated:t})}},t.getRepositoryRegistry=function(){return r}}),r("common/decorators/register-service.decorator",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Map;t.RegisterService=function(e,t){return void 0===t&&(t=!1),function(o){r.set(e,{ctor:o,delegated:t})}},t.getServiceRegistry=function(){return r}}),r("common/messaging/messaging",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new WeakMap;function o(e,t){if("function"==typeof t){var r=void 0;"string"==typeof e?r=e:e instanceof Error&&(r="string"==typeof e.message?e.message:"function"==typeof e.toString?e.toString():"Unknown error"),t(r)}else console.error(e)}t.addVisibleMethod=function(e,t){var o=e.constructor,i=r.get(o);i&&i.size?i.add(t):i=new Set([t]),r.set(o,i)},t.callMethod=function(e,t,s,a){return void 0===s&&(s=[]),i(this,void 0,void 0,function(){var i,u;return n(this,function(n){switch(n.label){case 0:if(n.trys.push([0,3,,4]),!e||!e.constructor)throw new Error("No target provided!");if(!r.has(e.constructor))throw new Error("Target has no visible methods.");if(!r.get(e.constructor).has(t))throw new Error("Method [ "+t+" ] is not a visible method.");if("function"!=typeof(i=e[t]))throw new Error("Method [ "+t+" ] is not a function or does not exist on the target.");return(u=i.bind(e).apply(void 0,s))&&"function"==typeof u.then?[4,u]:[3,2];case 1:u=n.sent(),n.label=2;case 2:return a(null,u),[3,4];case 3:return o(n.sent(),a),[3,4];case 4:return[2]}})})},t.handleCallbackError=o}),r("common/decorators/visible.decorator",["require","exports","common/messaging/messaging"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Visible=function(e,t,o){r.addVisibleMethod(e,t)}}),r("common/decorators/index",["require","exports","common/decorators/register-repository.decorator","common/decorators/register-service.decorator","common/decorators/visible.decorator"],function(e,t,r,o,i){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(o),n(i)}),r("common/services/utils/string-utils.service",["require","exports","common/decorators/index","common/enums/index"],function(e,t,r,o){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.stringContains=function(e,t){if(e&&t){Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;++r)if(e.indexOf(t[r])>-1)return!0}return!1},e=a([r.RegisterService(o.ServiceType.StringUtils)],e)}();t.StringUtilsService=i}),r("background/interfaces/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/interfaces/content-script-target",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/interfaces/index",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),r("background/legacy",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyGlobal=self}),r("background/repositories/auto-fill-state/auto-fill-state.repository",["require","exports","common/decorators/index","common/enums/index","common/repositories/auto-fill-state/index","background/legacy"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.states=new Map}return e.prototype.tryGetState=function(e){var t;try{t=this.getState(e)}catch(e){if(!(e instanceof ReferenceError))throw e}if(!t){var r=n.LegacyGlobal.LPTabs.get({tabID:e}),o=void 0;r&&(o=r.tabDetails.tabURL),t=new i.AutoFillState(e,o),this.setState(t)}return t},e.prototype.initialize=function(){},e.prototype.getState=function(e,t){var r=this.states.get(e);if(!r){var o="Could not find state for tab: "+e;if("function"==typeof t)return void t(o);throw new ReferenceError(o)}if("function"!=typeof t)return r;t(null,r)},e.prototype.setState=function(e){this.states.set(e.tabId,e)},e.prototype.deleteState=function(e){this.states.delete(e)},e.prototype.resetFrameState=function(e,t){this.states.has(e)&&this.states.get(e).resetFrameState(t)},e.prototype.deleteFrameState=function(e,t){this.states.has(e)&&this.states.get(e).deleteFrameState(t)},e.prototype.getFrameAlgorithmState=function(e,t,r,o,i){var n;try{var s=this.getState(e);n=s.getFrameAlgorithmState(t,r,o)}catch(e){if(!(e instanceof ReferenceError))throw e;n={}}if("function"!=typeof i)return n;i(null,n)},e.prototype.setFrameAlgorithmState=function(e,t,r,o,i){this.tryGetState(e).setFrameAlgorithmState(t,r,o,i)},e.prototype.setFrameAllowed=function(e,t,r){this.tryGetState(e).setFrameAllowed(t,r)},e.prototype.setFrameReady=function(e,t,r){this.tryGetState(e).setFrameReady(t,r)},e.prototype.getFillResults=function(e,t,r){var o;t=t||0;try{var i=this.getState(e);o=i.getResults()}catch(e){o={}}if("function"!=typeof r)return o;r(null,o)},a([r.Visible],e.prototype,"getState",null),a([r.Visible],e.prototype,"setState",null),a([r.Visible],e.prototype,"deleteState",null),a([r.Visible],e.prototype,"resetFrameState",null),a([r.Visible],e.prototype,"deleteFrameState",null),a([r.Visible],e.prototype,"getFrameAlgorithmState",null),a([r.Visible],e.prototype,"setFrameAlgorithmState",null),a([r.Visible],e.prototype,"setFrameAllowed",null),a([r.Visible],e.prototype,"setFrameReady",null),a([r.Visible],e.prototype,"getFillResults",null),e=a([r.RegisterRepository(o.RepositoryType.AutoFillState)],e)}();t.AutoFillStateRepository=s}),r("background/repositories/feature/feature.repository",["require","exports","common/decorators/index","common/enums/index","background/legacy"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){var e=this;this.featureEnumNames=new Set,this.featurePropertyNames=new Set,Object.keys(o.FeatureType).forEach(function(t){e.featureEnumNames.add(t),e.featurePropertyNames.add(o.FeatureType[t])})}return e.prototype.initialize=function(){},e.prototype.get=function(e){return i.LegacyGlobal.LPContentScriptFeatures[this.resolvePropertyName(e)]},e.prototype.set=function(e,t){i.LegacyGlobal.LPContentScriptFeatures[this.resolvePropertyName(e)]=t},e.prototype.resolvePropertyName=function(e){if(this.featureEnumNames.has(e))return o.FeatureType[e];if(this.featurePropertyNames.has(e))return e;throw new TypeError("Unrecognized feature name: [ "+e+" ]")},a([r.Visible],e.prototype,"get",null),a([r.Visible],e.prototype,"set",null),e=a([r.RegisterRepository(o.RepositoryType.Feature)],e)}();t.FeatureRepository=n}),r("background/repositories/repository-provider",["require","exports","common/provider.abstract","common/messaging/messaging"],function(e,t,r,o){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.getRepository=function(e){return this.instances[e]},t.prototype.call=function(e,t,r,i){void 0===r&&(r=[]);try{o.callMethod(this.getRepository(e),t,r,i)}catch(e){o.handleCallbackError(e,i)}},t}(r.ProviderAbstract);t.RepositoryProvider=i}),r("background/repositories/index",["require","exports","background/repositories/auto-fill-state/auto-fill-state.repository","background/repositories/feature/feature.repository","background/repositories/repository-provider"],function(e,t,r,o,i){function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r),n(o),n(i)}),r("background/services/service-provider",["require","exports","common/provider.abstract","common/enums/index","common/messaging/messaging","background/background.module"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.getService=function(e,t){var r=this.map.get(e);if(!r)return null;var o=r.delegated;if(!t&&o)throw new Error("Must provide a target for delegated service [ "+e+" ]");if(t&&!o)throw new Error("Target not supported for non-delegated service [ "+e+" ]");return o?new r.ctor(t):this.instances[e]},t.prototype.postInitialize=function(){e.prototype.postInitialize.call(this),window.basicAuth=this.getService(o.ServiceType.BasicAuth)},t.prototype.call=function(e,t,r,o){void 0===r&&(r=[]);try{i.callMethod(this.getService(e),t,r,o)}catch(e){i.handleCallbackError(e,o)}},t}(r.ProviderAbstract);t.ServiceProvider=s,t.callContentScriptService=function(e,t,r,o,s){n.getContentScriptInterfaces(e).then(function(e){return e.forEach(function(e){if("function"!=typeof s)return new Promise(function(i,n){e.LPModule.callService(t,r,o,function(e,t){return e?n(e):i(t)})});e.LPModule.callService(t,r,o,s)})}).catch(function(e){i.handleCallbackError(e,s)})}}),r("background/services/auto-fill/delegated-auto-fill.service",["require","exports","common/decorators/index","common/enums/index","background/services/service-provider"],function(e,t,r,o,s){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e){this.target=e}return e.prototype.initialize=function(){},e.prototype.fill=function(e){return i(this,void 0,void 0,function(){return n(this,function(t){return s.callContentScriptService(this.target,o.ServiceType.AutoFill,"fill",[e]),[2]})})},e=a([r.RegisterService(o.ServiceType.AutoFill,!0)],e)}();t.DelegatedAutoFillService=u}),r("background/services/basic-auth/auth-credential",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,r,o){void 0===t&&(t=""),void 0===r&&(r=""),void 0===o&&(o=!1),this.url=e,this.userName=t,this.password=r,this.suppliedBefore=o,this.cancelled=!1}}();t.AuthCredential=r}),r("background/services/basic-auth/basic-auth.service",["require","exports","common/decorators/index","common/enums/index","background/legacy","background/services/basic-auth/auth-credential"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.authCredentials={}}return e.prototype.initialize=function(){this.subscribeEvents()},e.prototype.subscribeEvents=function(){var e=this;i.LegacyGlobal.LPPlatform.onAuthRequired(function(t,r){if(i.LegacyGlobal.g_basicauth_feature_enabled&&"basic"===t.scheme){var o=e.authCredentials[t.tabId];if(o&&!o.cancelled&&!o.suppliedBefore)return e.authCredentials[t.tabId]=new n.AuthCredential(t.url,o.userName,o.password,!0),e.removeAuth(r),{authCredentials:{username:o.userName,password:o.password}};if(!o)return e.authCredentials[t.tabId]=new n.AuthCredential(t.url),{cancel:!0}}}),i.LegacyGlobal.LPPlatform.onTabClosed(function(t){e.removeAuth(t)})},e.prototype.removeAuth=function(e){this.authCredentials[e]&&delete this.authCredentials[e]},e.prototype.isBasicAuth=function(e,t){var r=!1,o=!1;if(t&&t.tabID){var i=this.authCredentials[t.tabID];i&&(i.url!==t.tabURL?this.removeAuth(t.tabID):i.cancelled||(r=!0,o=i.suppliedBefore))}e(r,o)},e.prototype.setAuthCredential=function(e,t,r,o){var i=this.authCredentials[o.tabID];i.userName=e,i.password=t,r()},e.prototype.cancelBasicAuth=function(e){this.authCredentials[e.tabID]&&(this.authCredentials[e.tabID].cancelled=!0)},e.prototype.hasFeature=function(e){e(!0)},e.prototype.isNotificationClosed=function(e){e("closed"===i.LegacyGlobal.localStorage_getItem("basicAuthPopupState"))},e.prototype.closeNotification=function(){i.LegacyGlobal.localStorage_setItem("basicAuthPopupState","closed")},e=a([r.RegisterService(o.ServiceType.BasicAuth)],e)}();t.BasicAuthService=s}),r("background/services/form-parser/form-meta-data",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.passwordsByValue={},this.textFieldsByValue={},this.textFieldsByType={},this.uniqueTextValues=[],this.uniquePasswords=[],e.fields&&(e.fields.forEach(function(e){"password"===e.type?t.aggregateField(e,e.value,t.passwordsByValue):(t.aggregateField(e,e.value,t.textFieldsByValue),t.aggregateField(e,e.type,t.textFieldsByType))}),this.uniqueTextValues=Object.keys(this.textFieldsByValue),this.uniquePasswords=Object.keys(this.passwordsByValue))}return e.prototype.aggregateField=function(e,t,r){var o=r[t];o?++o.count:r[t]={field:e,count:1}},e}();t.FormMetaData=r}),r("background/services/form-parser/field-parsers/field-parser.abstract",["require","exports","background/legacy"],function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.operations=[]}return e.regexMatches=function(e,t){var r=!1;if(e){var o=function(e,t){return"string"==typeof t&&e.test(t.toLowerCase())};Array.isArray(t)?t.forEach(function(t){return r=r||o(e,t)}):r=o(e,t)}return r},e.getFormFieldRegex=function(e){var t=r.LegacyGlobal.get_ff_translation(e);if(t)return new RegExp(t)},e.prototype.parse=function(e,t,r){for(var o=null,i=0,n=this.operations;i<n.length;i++){if((o=(0,n[i])(e,t,r))||!1===o)break}return o},e}();t.FieldParserAbstract=o}),r("background/services/form-parser/field-parsers/password-field-parser",["require","exports","background/services/form-parser/field-parsers/field-parser.abstract","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var n=e.call(this)||this;return n.stringUtils=i.getService(o.ServiceType.StringUtils),n.siteParser=i.getService(o.ServiceType.SiteParser),t.excludedFields.length||(t.excludedFields=[{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_ssn_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_cccsc_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_securityanswer_regexp")},{type:"attr",regex:r.FieldParserAbstract.getFormFieldRegex("ff_captcha_regexp")},{type:"text",regex:r.FieldParserAbstract.getFormFieldRegex("ff_text_ssn_regexp")},{type:"text",regex:r.FieldParserAbstract.getFormFieldRegex("ff_text_cccsc_regexp")}]),n.operations=[n.excludedFieldOperation,n.singlePasswordFieldOperation,n.multiplePasswordOperation,n.multiplePasswordsOneExistingOperation,n.passwordLikeAttribute],n.operations=n.operations.map(function(e){return e.bind(n)}),n}return u(t,e),t.prototype.excludedFieldOperation=function(e,o,i){for(var n=0;n<e.fields.length;++n)for(var s=e.fields[n],a=0;a<t.excludedFields.length;++a){var u=t.excludedFields[a];if(u.regex){if("attr"===u.type&&r.FieldParserAbstract.regexMatches(u.regex,[s.id,s.attributes.name]))return!1;if("text"===u.type&&r.FieldParserAbstract.regexMatches(u.regex,s.label))return!1}}return null},t.prototype.singlePasswordFieldOperation=function(e,t,r){if(1===t.uniquePasswords.length){var o=t.uniquePasswords[0];return 2===t.passwordsByValue[o].count&&(2===e.fields.length?e.passwordChangeForm=!0:e.createAccountForm=!0),o}return null},t.prototype.multiplePasswordOperation=function(e,t,r){for(var o=0,i=t.uniquePasswords;o<i.length;o++){var n=i[o];if(t.passwordsByValue[n].count>1)return 2===t.uniquePasswords.length?(e.passwordChangeForm=!0,e.originalPassword=t.uniquePasswords[0]===n?t.uniquePasswords[1]:t.uniquePasswords[0]):e.createAccountForm=!0,n}return null},t.prototype.multiplePasswordsOneExistingOperation=function(e,t,r){if(2===t.uniquePasswords.length){var o=this.findMatchingPassword(r.getSites(),t.uniquePasswords);if(o)return e.passwordChangeForm=!0,e.originalPassword=o,t.uniquePasswords[0]===o?t.uniquePasswords[1]:t.uniquePasswords[0]}return null},t.prototype.passwordLikeAttribute=function(e,t,r){for(var o=0,i=t.uniquePasswords;o<i.length;o++){var n=i[o],s=t.passwordsByValue[n].field,a=["pw","pass"];if(this.stringUtils.stringContains(s.attributes.name,a)||this.stringUtils.stringContains(s.id,a))return n}},t.prototype.findMatchingPassword=function(e,t){for(var r=0;r<e.length;++r){var o=this.siteParser.findMatchingSitePassword(e[r],t);if(o)return o}return null},t.excludedFields=[],t}(r.FieldParserAbstract);t.PasswordFieldParser=n}),r("background/services/form-parser/field-parsers/user-name-field-parser",["require","exports","background/services/form-parser/field-parsers/field-parser.abstract","common/enums/service-type","background/legacy","background/background.module"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var i=e.call(this)||this;return i.isStrict=t,i.userNameRegEx=r.FieldParserAbstract.getFormFieldRegex("ff_username_regexp"),i.stringUtils=n.getService(o.ServiceType.StringUtils),i.isStrict?i.operations=[i.userNameLikeLabelOperation,i.uniqueEmailFieldOperation,i.userNameLikeAttributeOperation]:i.operations=[i.userNameLikeLabelOperation,i.singleTextFieldOperation,i.multipleTextFieldOperation,i.nearPasswordFieldOpeartion,i.existingUserNameOperation,i.uniqueEmailFieldOperation,i.userNameLikeAttributeOperation],i.operations=i.operations.map(function(e){return e.bind(i)}),i}return u(t,e),t.prototype.userNameLikeLabelOperation=function(e,t,o){if(this.userNameRegEx)for(var i=0,n=e.fields;i<n.length;i++){var s=n[i];if(r.FieldParserAbstract.regexMatches(this.userNameRegEx,s.label))return s.value}return null},t.prototype.userNameLikeAttributeOperation=function(e,t,r){for(var o=0,i=t.uniqueTextValues;o<i.length;o++){var n=i[o],s=t.textFieldsByValue[n].field;if(this.stringUtils.stringContains(s.attributes.name,"user")||this.stringUtils.stringContains(s.id,"user"))return n}return null},t.prototype.singleTextFieldOperation=function(e,t,r){if(1===t.uniqueTextValues.length){var o=t.uniqueTextValues[0];return 2===t.textFieldsByValue[o].count&&(e.createAccountForm=!0),o}return null},t.prototype.multipleTextFieldOperation=function(e,t,r){for(var o=0,i=t.uniqueTextValues;o<i.length;o++){var n=i[o];if(t.textFieldsByValue[n].count>1)return e.createAccountForm=!0,n}return null},t.prototype.nearPasswordFieldOpeartion=function(e,t,r){for(var o=e.fields,i=1;i<o.length;++i){if("password"===o[i].type){var n=o[i-1];if("password"!==n.type)return n.value}}return null},t.prototype.existingUserNameOperation=function(e,t,r){for(var o in i.LegacyGlobal.g_sites)if(t.uniqueTextValues.indexOf(i.LegacyGlobal.g_sites[o].unencryptedUsername)>-1)return i.LegacyGlobal.g_sites[o].unencryptedUsername;return null},t.prototype.uniqueEmailFieldOperation=function(e,r,o){for(var i=[],n=0,s=r.uniqueTextValues;n<s.length;n++){var a=s[n],u=a.match(t.emailRegex);u&&1===u.length&&i.push(a)}return 1===i.length?i[0]:null},t.emailRegex=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*/g,t}(r.FieldParserAbstract);t.UserNameFieldParser=s}),r("background/services/form-parser/field-parsers/index",["require","exports","background/services/form-parser/field-parsers/password-field-parser","background/services/form-parser/field-parsers/user-name-field-parser"],function(e,t,r,o){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r),i(o)}),r("background/services/form-parser/parsed-form",["require","exports","background/background.module","common/enums/index","background/services/form-parser/form-meta-data","background/services/form-parser/field-parsers/index"],function(e,t,r,o,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,s){this.formData=null,this.userNameField=null,this._succeeded=!1,this._submitted=!1;var a=r.getService(o.ServiceType.SiteParser);t.fields=t.fields||[];var u=new i.FormMetaData(t);if(!t.password)if(t.generatedPassword)t.password=t.generatedPassword;else{var c=(new n.PasswordFieldParser).parse(t,u,e);"string"==typeof c&&(t.password=c)}var l=new n.UserNameFieldParser(s&&s.strict).parse(t,u,e),d=[];"string"==typeof l&&(d=e.getSites().filter(function(e){return a.hasMatchingSiteUserName(e,l)}),t.username&&0===d.length&&!t.createAccountForm||(t.username=l));if(t.username&&!t.createAccountForm)for(var p=0,f=t.fields;p<f.length;p++){var m=f[p];if(m.value===t.username){this.userNameField=m;break}}this.formData=t,this._submitted=!t.generatedPassword}return e.prototype.submitted=function(e){return"boolean"==typeof e&&(this._submitted=e),this._submitted},e.prototype.succeeded=function(e){return"boolean"==typeof e&&(this._succeeded=e),this._succeeded},e.prototype.getUsernameField=function(){return this.userNameField},e.prototype.getUsername=function(){return this.formData.username},e.prototype.getPassword=function(){return this.formData.password},e.prototype.getOriginalPassword=function(){return this.formData.originalPassword},e.prototype.getFormData=function(){return this.formData},e.prototype.getFields=function(){return this.formData.fields},e.prototype.isChangePasswordForm=function(){return!!this.formData.passwordChangeForm},e.prototype.isCreateAccountForm=function(){return!!this.formData.passwordChangeForm},e.prototype.isBasicAuthentication=function(){return!!this.formData.basicAuthentication},e.prototype.shouldSaveFields=function(){return!this.isChangePasswordForm()&&!this.isCreateAccountForm()},e.prototype.getURL=function(){return this.formData.url},e}();t.ParsedForm=s}),r("background/services/form-parser/form-parser.service",["require","exports","common/decorators/index","common/enums/index","background/services/form-parser/parsed-form"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.parse=function(e,t,r){return new i.ParsedForm(e,t,r)},e=a([r.RegisterService(o.ServiceType.FormParser)],e)}();t.FormParserService=n}),r("background/services/segment/segment.service",["require","exports","common/decorators/index","common/enums/index","background/legacy"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.send=function(e,t){i.LegacyGlobal.sendLpImprove(e,t)},e=a([r.RegisterService(o.ServiceType.Segment)],e)}();t.SegmentService=n}),r("background/services/site-parser/site-parser.service",["require","exports","common/decorators/index","common/enums/index","background/legacy"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.decrypt=function(e,t){return i.LegacyGlobal.lpmdec_acct(t,!0,e,i.LegacyGlobal.g_shares)},e.prototype.findMatchingSitePassword=function(e,t){Array.isArray(t)||(t=[t]);var r=t.indexOf(this.decrypt(e,e.password));if(-1===r&&e.fields&&e.fields.length>0)for(var o=0;o<e.fields.length;++o){var i=e.fields[o];if("password"===i.type&&(r=t.indexOf(this.decrypt(e,i.value)))>-1)break}return r>-1?t[r]:null},e.prototype.hasMatchingSiteUserName=function(e,t){if(!t)return!1;if(this.userNamesMatch(e.unencryptedUsername,t))return!0;if(e.fields&&e.fields.length)for(var r=0,o=e.fields;r<o.length;r++){var i=o[r];switch(i.type){case"text":case"email":case"tel":if(this.userNamesMatch(this.decrypt(e,i.value),t))return!0}}return!1},e.prototype.userNamesMatch=function(e,t){return e===t||this.userNameInEmail(e,t)||this.userNameInEmail(t,e)||this.isMaskedUsername(e,t)},e.prototype.userNameInEmail=function(e,t){if(t&&t.indexOf("@")>-1){var r=t.split("@");return 2===r.length&&e===r[0]}return!1},e.prototype.isMaskedUsername=function(e,t){return(t.indexOf("*")>-1||t.indexOf(String.fromCharCode(8226))>-1)&&(e.length===t.length&&(e[0]===t[0]||e[e.length-1]===t[t.length-1]))},e=a([r.RegisterService(o.ServiceType.SiteParser)],e)}();t.SiteParserService=n}),r("background/services/topic/topic.service",["require","exports","common/decorators/index","common/enums/index","background/legacy"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){},e.prototype.subscribe=function(e,t){i.LegacyGlobal.Topics.get(e).subscribe(function(e){return t(e)})},e=a([r.RegisterService(o.ServiceType.Topic)],e)}();t.TopicService=n}),r("background/services/web-request/web-request-shim.service",["require","exports","common/decorators/index","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.initialize=function(){var e=this;if(this.webRequest=i.getService(o.ServiceType.WebRequest),!this.webRequest.isApiSupported()){var t=i.getService(o.ServiceType.Topic);t.subscribe(o.TopicType.LoginFinished,function(){e.webRequest.isEnabled()&&t.subscribe(o.TopicType.ProcessedFormSubmit,function(t){var r=t.password,o=t.tabId,i=t.inputValues;r&&(e.handleOnBefore(o,i,"NONE"),e.handleOnCompleted(o,"NONE",200))})})}},e.prototype.handleOnBefore=function(e,t,r){!this.webRequest.isApiSupported()&&this.webRequest.isEnabled()&&this.webRequest.addRequest({requestBody:{formData:{inputValues:t}},requestId:r,tabId:e,method:void 0,url:void 0,timeStamp:void 0,frameId:void 0,parentFrameId:void 0,type:void 0})},e.prototype.handleOnCompleted=function(e,t,r){!this.webRequest.isApiSupported()&&this.webRequest.isEnabled()&&this.webRequest.resolveRequest({tabId:e,requestId:t,statusCode:r})},e.prototype.handleOnError=function(e,t,r,o){!this.webRequest.isApiSupported()&&this.webRequest.isEnabled()&&this.webRequest.resolveRequest({tabId:e,requestId:t,statusCode:r,error:o})},a([r.Visible],e.prototype,"handleOnBefore",null),a([r.Visible],e.prototype,"handleOnCompleted",null),a([r.Visible],e.prototype,"handleOnError",null),e=a([r.RegisterService(o.ServiceType.WebRequestShim)],e)}();t.WebRequestShimService=n}),r("background/services/web-request/request-resolvers/request-resolver.abstract",["require","exports"],function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.type=e}return Object.defineProperty(e.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),e}();t.RequestResolver=r}),r("background/services/web-request/request-resolvers/injected-password-submitted",["require","exports","background/services/web-request/request-resolvers/request-resolver.abstract","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this,o.ResolverType.InjectedPasswordSubmitted)||this;return t.segmentService=i.getService(o.ServiceType.Segment),t}return u(t,e),t.prototype.resolveSuccess=function(){this.segmentService.send("passwordsubmitted",{type:"inject"})},t.prototype.resolveError=function(e,t){this.segmentService.send("passwordsubmitted",{type:"inject",error:e,status:t})},t}(r.RequestResolver);t.InjectedPasswordSubmittedResolver=n}),r("background/services/web-request/request-resolvers/password-submitted",["require","exports","background/services/web-request/request-resolvers/request-resolver.abstract","common/enums/index","background/background.module"],function(e,t,r,o,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this,o.ResolverType.PasswordSubmitted)||this;return t.segmentService=i.getService(o.ServiceType.Segment),t}return u(t,e),t.prototype.resolveSuccess=function(){this.segmentService.send("passwordsubmitted",{type:"webrequest"})},t.prototype.resolveError=function(e,t){this.segmentService.send("passwordsubmitted",{type:"webrequest",error:e,status:t})},t}(r.RequestResolver);t.PasswordSubmittedResolver=n}),r("background/services/web-request/request-resolvers/index",["require","exports","background/services/web-request/request-resolvers/injected-password-submitted","background/services/web-request/request-resolvers/password-submitted"],function(e,t,r,o){function i(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),i(r),i(o)}),r("background/services/web-request/web-request.service",["require","exports","common/enums/index","common/decorators/index","background/legacy","background/background.module","background/services/web-request/request-resolvers/index"],function(e,t,r,o,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(){var e=this;this.requests={},this.queries={},this.successRegex=/^2[0-9][0-9]$/,this.onBeforeRequestListener=function(t){e.shouldTrackRequest(t)&&(e.requests[e.getRequestKey(t.tabId,t.requestId)]=t)},this.onCompletedListener=function(t){var r=t.tabId,o=t.requestId,i=(t.statusCode,e.getMatchingQuery(e.getRequestKey(r,o)));i&&e.requestResolvers[i.action].resolveSuccess()},this.onErrorOccurredListener=function(t){var r=t.tabId,o=t.requestId,i=t.statusCode,n=t.error,s=e.getMatchingQuery(e.getRequestKey(r,o));s&&e.requestResolvers[s.action].resolveError(n,i)},"undefined"!=typeof browser?this.webRequestApi=browser.webRequest:"undefined"!=typeof chrome&&(this.webRequestApi=chrome.webRequest)}return e.prototype.trackResponse=function(e,t,r){this.queries[e]={fields:t,action:r}},e.prototype.isApiSupported=function(){return!!this.webRequestApi&&!i.LegacyGlobal.g_isedge},e.prototype.isEnabled=function(){return this.features.get(r.FeatureType.PasswordSubmittedEvent)},e.prototype.addRequest=function(e){this.onBeforeRequestListener(e)},e.prototype.resolveRequest=function(e){var t=e.tabId,r=e.requestId,o=e.statusCode,i=e.error;i?this.onErrorOccurredListener({tabId:t,requestId:r,statusCode:o,error:i}):this.onCompletedListener({tabId:t,requestId:r,statusCode:o})},e.prototype.shouldTrackRequest=function(e){return e.requestBody&&!e.requestBody.error&&(e.requestBody.formData||e.requestBody.raw)},e.prototype.takeRequest=function(e){var t=this;if(!this.requests[e])return null;var r=this.requests[e];if(r)delete this.requests[e];else{var o=this.parseRequestKey(e).tabId,i=[];Object.keys(this.requests).forEach(function(e){t.parseRequestKey(e).tabId===o&&(i.push(t.requests[e]),delete t.requests[e])}),i.length&&(r=i[0])}return r},e.prototype.getMatchingQuery=function(e){var t=this.takeRequest(e);if(!t)return null;var r=this.queries[t.tabId];if(!r)return null;var o=this.getSubmittedDataString(t);return o&&r.fields.length&&r.fields.some(function(e){return-1===o.indexOf(e)})?null:(delete this.queries[t.tabId],r)},e.prototype.getSubmittedDataString=function(e){return e.requestBody?e.requestBody.formData?JSON.stringify(e.requestBody.formData):e.requestBody.raw.reduce(function(e,t){return e+String.fromCharCode.apply(null,new Uint8Array(t.bytes))},""):null},e.prototype.isSuccessCode=function(e){return this.successRegex.test(e)},e.prototype.initialize=function(){var e=this;this.requestResolvers=this.setupRequestResolvers(),this.features=n.getRepository(r.RepositoryType.Feature);var t=n.getService(r.ServiceType.Topic);t.subscribe(r.TopicType.LoginFinished,function(){return e.setup()}),t.subscribe(r.TopicType.ClearData,function(){return e.teardown()})},e.prototype.destroy=function(){this.teardown()},e.prototype.setup=function(){if(this.isApiSupported()&&this.isEnabled()){var e={urls:["<all_urls>"],types:["xmlhttprequest","main_frame","sub_frame","other"]};this.webRequestApi.onBeforeRequest.addListener(this.onBeforeRequestListener,e,["requestBody"]),this.webRequestApi.onCompleted.addListener(this.onCompletedListener,e,null),this.webRequestApi.onErrorOccurred.addListener(this.onErrorOccurredListener,e)}},e.prototype.teardown=function(){this.isApiSupported()&&this.isEnabled()&&(this.webRequestApi.onBeforeRequest.removeListener(this.onBeforeRequestListener),this.webRequestApi.onCompleted.removeListener(this.onCompletedListener),this.webRequestApi.onErrorOccurred.removeListener(this.onErrorOccurredListener))},e.prototype.setupRequestResolvers=function(){var e=[];return e[r.ResolverType.PasswordSubmitted]=new s.PasswordSubmittedResolver,e[r.ResolverType.InjectedPasswordSubmitted]=new s.InjectedPasswordSubmittedResolver,e},e.prototype.getRequestKey=function(e,t){return t||(t="NONE"),e+"-"+t},e.prototype.parseRequestKey=function(e){var t=e.split("-");return{tabId:t[0],requestId:t[1]}},a([o.Visible],e.prototype,"trackResponse",null),a([o.Visible],e.prototype,"isApiSupported",null),a([o.Visible],e.prototype,"isEnabled",null),e=a([o.RegisterService(r.ServiceType.WebRequest)],e)}();t.WebRequestService=u}),r("background/services/index",["require","exports","background/services/auto-fill/delegated-auto-fill.service","background/services/basic-auth/basic-auth.service","background/services/form-parser/form-parser.service","background/services/segment/segment.service","background/services/service-provider","background/services/site-parser/site-parser.service","background/services/topic/topic.service","background/services/web-request/web-request-shim.service","background/services/web-request/web-request.service","common/services/utils/string-utils.service"],function(e,t,r,o,i,n,s,a,u,c,l,d){function p(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),p(r),p(o),p(i),p(n),p(s),p(a),p(u),p(c),p(l),p(d)}),r("background/background.module",["require","exports","background/repositories/index","background/services/index","common/decorators/index","common/module.abstract","background/legacy"],function(e,t,r,o,s,a,c){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return window.addEventListener("beforeunload",function(){t.serviceProvider.teardown(),t.repositoryProvider.teardown()}),t}return u(t,e),t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.initialize=function(){return i(this,void 0,void 0,function(){return n(this,function(e){return this.repositoryProvider=new r.RepositoryProvider(s.getRepositoryRegistry()),this.serviceProvider=new o.ServiceProvider(s.getServiceRegistry()),this.repositoryProvider.initialize(),this.serviceProvider.initialize(),[2]})})},t.prototype.postInitialize=function(){return i(this,void 0,void 0,function(){return n(this,function(e){return this.repositoryProvider.postInitialize(),this.serviceProvider.postInitialize(),[2]})})},t.prototype.getServiceProvider=function(){return this.serviceProvider},t.prototype.getRepositoryProvider=function(){return this.repositoryProvider},t.prototype.getService=function(e){var t=this.serviceProvider.getService(e);if(!t)throw new Error("Cannot find service [ "+e+" ]");return t},t.prototype.getRepository=function(e){var t=this.repositoryProvider.getRepository(e);if(!t)throw new Error("Cannot find service [ "+e+" ]");return t},t.instance=null,t}(a.ModuleAbstract);t.getContentScriptInterfaces=function(e){return i(this,void 0,void 0,function(){var t,r,o;return n(this,function(i){if(t=[],e.interface)t.push(e.interface);else{if(!e.tabId)throw new TypeError("Invalid target provided.");if(!(r=c.LegacyGlobal.LPTabs.get({tabID:e.tabId})))throw new TypeError("No tab with id "+e.tabId+" found.");if(o=void 0,e.frameId&&"top"!==e.frameId){if("number"!=typeof e.frameId)throw new TypeError("Unsupported frame id value: "+e.frameId);o=r.getFrame(e.frameId)}else o=r.getTop();if(!o)throw new TypeError("No content script interface found for tab "+e.tabId);t.push(o)}return[2,t]})})},t.getService=function(e){return l.getInstance().getService(e)},t.getRepository=function(e){return l.getInstance().getRepository(e)},t.isInitialized=function(e){return l.getInstance().isInitialized(e)},t.callService=function(e,t,r,o){void 0===r&&(r=[]),l.getInstance().getServiceProvider().call(e,t,r,o)},t.callRepository=function(e,t,r,o){void 0===r&&(r=[]),l.getInstance().getRepositoryProvider().call(e,t,r,o)},t.default=l.getInstance()}),self.LPModule=t("background/background.module")}).call(self);
//# sourceMappingURL=sourcemaps/modules-background.js.map
